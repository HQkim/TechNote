# 데드락 (DeadLock, 교착상태)

> 둘 이상의 프로세스가 다른 프로세스가 점유하고 있는 자원을 서로 기다리면서 무한 대기에 빠지는 상황



### 데드락 (DeadLock)의 발생조건

데드락이 발생하기 위해서는 다음의 4가지 조건이 모두 성립해야 한다. (하나라도 성립하지 않으면 데드락 문제 해결 가능)

1. **상호 배제 (Mutual exclusion)**
   - 자원은 한번에 한 프로세스만 사용할 수 있음
2. **점유 대기 (Hold and wait)**
   - 최소한 하나의 자원을 점유하고 있으면서 다른 프로세스에 할당되어 사용하고 있는 자원을 추가로 점유하기 위해 대기하는 프로세스가 존재해야 함
3. **비선점 (No preemption)**
   - 다른 프로세스에 할당된 자원은 사용이 끝날 때까지 강제로 빼앗을 수 없음
4. **순환 대기 (Circular wait)**
   - 프로세스의 집합에서 순환 형태로 자원을 대기하고 있어야 함. 프로세스 집합을 P = {p1, p2, ... pn}이라고 할 때 p1이 p2를 p2가 p3를 pn이 p1을 대기하고 있어야 함.



### 데드락의 해결법

#### 데드락 예방 (Prevention)

**데드락의 발생조건 4가지 중 하나 이상을 방지(부정)**하여 데드락 발생 가능성을 차단하는 방법
**예방으로는 시스템의 효율성이 낮아질** 수 있다.

- 상호 배제 부정 : 한번에 여러 프로세스가 공유 자원 사용할 수 있게 한다. 동기화 관련 문제가 발생할 수 있음
- 점유 대기 부정 : 프로세스 실행에 필요한 모든 자원을 한꺼번에 요구하고 허용할 때까지 작업을 보류해서, 나중에 또다른 자원을 점유하기 위한 대기를 없앤다.
- 비선점 부정 : 높은 우선순위의 프로세스가 해당 자원을 선점할 수 있도록 한다.
- 순환 대기 부정: 자원에 고유번호 할당 후 오름차순으로만 자원을 요청할 수 있도록 한다. 자원의 낭비 가능성이 있다.



#### 회피 (Avoidance)
교착 상태 발생 시 피해나가는 방법

- 은행원 알고리즘(Banker's Algorithm)

  - 은행에서 모든 고객의 요구가 충족되도록 현금을 할당하는데서 유래
  - 프로세스가 자원을 요구할 때, 시스템은 자원을 할당한 후에도 안정 상태로 남아있게 되는지 사전에 검사하여 교착 상태 회피
  - 안정 상태면 자원 할당, 아니면 다른 프로세스들이 자원 해지까지 대기

  *안정 상태: 시스템의 프로세스들이 요청하는 모든 자원을, 데드락을 발생시키지 않으면서도 차례로 모두에게 할당해 줄 수 있는 상태

- 은행원 알고리즘은, 미리 프로세스별 최대 자원 요구량을 알아야 하고, 할당할 수 있는 자원 수가 일정해야 하는 등 사용에 있어 제약조건이 많고, 그에 따른 자원 이용도 하락 등 단점이 존재한다.

  

#### 데드락 탐지 (Detection) 및 회복 (Recovery)

교착 상태가 되도록 허용한 다음 회복시키는 방법

1. 탐지 (Detection)

   - 자원 할당 그래프를 통해 교착 상태를 탐지함
   - 자원 요청 시, 탐지 알고리즘을 실행시켜 그에 대한 오버헤드가 발생

2. 회복 (Recovery)

   - 프로세스 종료 방법

     - 교착 상태에 빠진 모든 프로세스를 중단 
     - 교착상태가 끝날때 까지 하나씩 프로세스를 중지

   - 자원 선점 방법

     - 교착 상태의 프로세스가 점유하고 있는 자원을 선점해 다른 프로세스에게 할당 (해당 프로세스 일시정지)

     

### 참고

[데드락 (DeadLock, 교착 상태)](https://gyoogle.dev/blog/computer-science/operating-system/DeadLock.html)

[[운영체제] 데드락(Deadlock, 교착 상태)이란?](https://chanhuiseok.github.io/posts/cs-2/)
